import { useVerifyWHitelistRequestMutation } from "@/redux/features/api/apiSlice";
import { Button, Input, message } from "antd";
import Head from "next/head";
import { useRouter } from "next/router";
import { useState } from "react";

export default function Home() {
  const router = useRouter();
  const [otp, setOtp] = useState("");
  const [verifyWHitelistRequest, { isLoading }] =
    useVerifyWHitelistRequestMutation();

  return (
    <>
      <Head>
        <title>Radish Admin / Verify Whitelist Request</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="h-screen w-screen flex justify-center items-center">
        <section className="w-[500px] h-[500px] bg-secondaryLightDark rounded-2xl flex flex-col items-center justify-center px-6">
          <p className="text-[20px] font-extrabold mt-4 text-center">
            Radish Admin Whitelist Verification
          </p>
          <p className="my-4 text-primary">
            Requested Email :{" "}
            <span className="text-primary">{router.query.email}</span>
          </p>
          <Input
            className="mt-4"
            value={otp}
            onChange={(e) => setOtp(e.target.value)}
            placeholder="Enter the verification code sent to your email"
          />
          <Button
            type="primary"
            className="w-full mt-5"
            onClick={() => {
              verifyWHitelistRequest({
                email: router.query.email,
                OTPuuid: router.query.id,
                OTP: otp,
              }).then((res) => {
                if (res.data?.success) {
                  message.success("Email Whitelisted Successfully");
                  router.push("/admins");
                } else {
                  message.error("Invalid credentials");
                }
              });
            }}
            loading={isLoading}
          >
            Whitelist This Email
          </Button>
        </section>
      </main>
    </>
  );
}
